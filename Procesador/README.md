 
---

## Ejemplo de configuración en `build.gradle.kts`

A continuación se muestra una configuración recomendada para tu módulo/app que utiliza este procesador y Protobuf:

```kotlin
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
    alias(libs.plugins.protobuf)
    alias(libs.plugins.mi.ksp)
}

android {
    namespace = "com.grupoalv.pruebasproto"
    compileSdk = 36

    defaultConfig {
        applicationId = "com.example.pruebasproto"
        minSdk = 24
        targetSdk = 36
        versionCode = 1
        versionName = "1.0"
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = "11"
    }
    buildFeatures {
        compose = true
    }
}

protobuf {
    protoc {
        artifact = "com.google.protobuf:protoc:3.25.1"
    }
    generateProtoTasks {
        tasks.named("kspDebugKotlin") {
            finalizedBy("copyGeneratedProtoFiles")
        }
        all().forEach {
            it.builtins {
                register("java") {
                    option("lite") // Necesario para Android
                }
            }
        }
    }
}

// --- TAREAS DE LIMPIEZA ---

val cleanKspGenerated by tasks.registering(Delete::class) {
    delete("build/generated/ksp/")
}

val cleanProtoGenerated by tasks.registering(Delete::class) {
    delete("src/main/proto/")
}

tasks.register("copyGeneratedProtoFiles") {
    doLast {
        val kspOutputDir = file("build/generated/ksp/debug/resources")
        val protoDir = file("src/main/proto")
        if (kspOutputDir.exists()) {
            protoDir.mkdirs()
            kspOutputDir.walkTopDown()
                .filter { it.extension == "proto" }
                .forEach { protoFile ->
                    val targetFile = File(protoDir, protoFile.name)
                    protoFile.copyTo(targetFile, overwrite = true)
                    println("📄 Copiado: 24{protoFile.name} a src/main/proto/")
                }
        } else {
            println("⚠️ No se encontró el directorio KSP: $kspOutputDir")
        }
    }
}

dependencies {
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx)
    implementation(libs.androidx.activity.compose)
    implementation(platform(libs.androidx.compose.bom))
    implementation(libs.androidx.ui)
    implementation(libs.androidx.ui.graphics)
    implementation(libs.androidx.ui.tooling.preview)
    implementation(libs.androidx.material3)
    testImplementation(libs.junit)
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(platform(libs.androidx.compose.bom))
    androidTestImplementation(libs.androidx.ui.test.junit4)
    debugImplementation(libs.androidx.ui.tooling)
    debugImplementation(libs.androidx.ui.test.manifest)

    // KSP y procesador LOCAL
    ksp("com.github.FrancoAlv:GenerateProtoProcesador:5.0.0")
    implementation("com.github.FrancoAlv:GenerateProtoProcesador:5.0.0")
    implementation("com.github.FrancoAlv:GenerateProto:2.0.0")

    // DataStore
    implementation(libs.androidx.datastore)
    implementation(libs.androidx.datastore.core)
    implementation(libs.protobuf.javalite)

    // ViewModel y Lifecycle
    implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.7.0")
    implementation("androidx.lifecycle:lifecycle-runtime-compose:2.7.0")
}

---

## ⚠️ Requisitos obligatorios para usar el procesador

Para que el procesador funcione correctamente, **debes** tener en tu `build.gradle.kts` (o `build.gradle`) lo siguiente:

### 1. Plugins necesarios

**Estos plugins son OBLIGATORIOS para que el procesador funcione:**

```kotlin
plugins {
    alias(libs.plugins.protobuf)      // Plugin de Protobuf
    alias(libs.plugins.mi.ksp)        // Plugin de KSP
    // ...otros plugins necesarios para tu proyecto
}
```

**Versiones recomendadas en `libs.versions.toml`:**
```toml
[versions]
protobufPlugin = "0.9.5"
kotlin = "2.0.21"
symbolProcessingApi = "2.0.21-1.0.25"

[plugins]
mi-ksp = { id = "com.google.devtools.ksp", version = "2.0.21-1.0.25" }
protobuf = { id = "com.google.protobuf", version.ref = "protobufPlugin" }
```

### 2. Configuración de Protobuf

```kotlin
protobuf {
    protoc {
        artifact = "com.google.protobuf:protoc:3.25.1"
    }
    generateProtoTasks {
        tasks.named("kspDebugKotlin") {
            finalizedBy("copyGeneratedProtoFiles")
        }
        all().forEach {
            it.builtins {
                register("java") {
                    option("lite") // Necesario para Android
                }
            }
        }
    }
}
```

### 3. Tareas de limpieza y copia de archivos `.proto`

```kotlin
// Limpia los archivos generados por KSP
tasks.register("cleanKspGenerated", Delete::class) {
    delete("build/generated/ksp/")
}

// Limpia los archivos .proto generados/copied en src/main/proto
tasks.register("cleanProtoGenerated", Delete::class) {
    delete("src/main/proto/")
}

// Task para copiar archivos proto generados por KSP a src/main/proto
tasks.register("copyGeneratedProtoFiles") {
    doLast {
        val kspOutputDir = file("build/generated/ksp/debug/resources")
        val protoDir = file("src/main/proto")
        if (kspOutputDir.exists()) {
            protoDir.mkdirs()
            kspOutputDir.walkTopDown()
                .filter { it.extension == "proto" }
                .forEach { protoFile ->
                    val targetFile = File(protoDir, protoFile.name)
                    protoFile.copyTo(targetFile, overwrite = true)
                    println("📄 Copiado: ${protoFile.name} a src/main/proto/")
                }
        } else {
            println("⚠️ No se encontró el directorio KSP: $kspOutputDir")
        }
    }
}
```

### 4. Dependencias requeridas

```kotlin
dependencies {
    ksp("com.github.FrancoAlv:GenerateProtoProcesador:5.0.0")
    implementation("com.github.FrancoAlv:GenerateProtoProcesador:5.0.0")
    implementation("com.github.FrancoAlv:GenerateProto:2.0.0")
    // ...otras dependencias necesarias
}
```

> **IMPORTANTE:**
> - Sin estas configuraciones, el procesador **no generará ni copiará** los archivos `.proto` correctamente.
> - Asegúrate de tener los plugins y dependencias en tu archivo `libs.versions.toml` si usas versiones centralizadas.

--- 